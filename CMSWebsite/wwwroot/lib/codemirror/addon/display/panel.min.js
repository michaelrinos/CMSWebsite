!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function p(e,t,i,n){this.cm=e,this.node=t,this.options=i,this.height=n,this.cleared=!1}function l(e,t){for(var i=t.nextSibling;i;i=i.nextSibling)if(i==e.getWrapperElement())return 1}e.defineExtension("addPanel",function(e,t){t=t||{},this.state.panels||function(r){var e=r.getWrapperElement(),t=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,o=parseInt(t.height),s=r.state.panels={setHeight:e.style.height,panels:[],wrapper:document.createElement("div")};e.parentNode.insertBefore(s.wrapper,e);var i=r.hasFocus();s.wrapper.appendChild(e),i&&r.focus();r._setSize=r.setSize,null!=o&&(r.setSize=function(e,t){if(t=t||s.wrapper.offsetHeight,"number"!=typeof(s.setHeight=t)){var i=/^(\d+\.?\d*)px$/.exec(t);t=i?Number(i[1]):(s.wrapper.style.height=t,s.wrapper.offsetHeight)}var n=t-s.panels.map(function(e){return e.node.getBoundingClientRect().height}).reduce(function(e,t){return e+t},0);r._setSize(e,n),o=t})}(this);var i=this.state.panels,n=i.wrapper,r=this.getWrapperElement(),o=t.replace instanceof p&&!t.replace.cleared;t.after instanceof p&&!t.after.cleared?n.insertBefore(e,t.before.node.nextSibling):t.before instanceof p&&!t.before.cleared?n.insertBefore(e,t.before.node):o?(n.insertBefore(e,t.replace.node),t.replace.clear(!0)):"bottom"==t.position?n.appendChild(e):"before-bottom"==t.position?n.insertBefore(e,r.nextSibling):"after-top"==t.position?n.insertBefore(e,r):n.insertBefore(e,n.firstChild);var s=t&&t.height||e.offsetHeight,a=new p(this,e,t,s);return i.panels.push(a),this.setSize(),t.stable&&l(this,e)&&this.scrollTo(null,this.getScrollInfo().top+s),a}),p.prototype.clear=function(e){if(!this.cleared){this.cleared=!0;var t=this.cm.state.panels;t.panels.splice(t.panels.indexOf(this),1),this.cm.setSize(),this.options.stable&&l(this.cm,this.node)&&this.cm.scrollTo(null,this.cm.getScrollInfo().top-this.height),t.wrapper.removeChild(this.node),0!=t.panels.length||e||function(e){var t=e.state.panels;e.state.panels=null;var i=e.getWrapperElement();t.wrapper.parentNode.replaceChild(i,t.wrapper),i.style.height=t.setHeight,e.setSize=e._setSize,e.setSize()}(this.cm)}},p.prototype.changed=function(){this.height=this.node.getBoundingClientRect().height,this.cm.setSize()}});