!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(L){"use strict";var k=L.Pos;function H(t,e,r){return r?0<=t.indexOf(e):0==t.lastIndexOf(e,0)}L.registerHelper("hint","xml",function(t,e){var r=e&&e.schemaInfo,n=e&&e.quoteChar||'"',s=e&&e.matchInMiddle;if(r){var i=t.getCursor(),a=t.getTokenAt(i);if(a.end>i.ch&&(a.end=i.ch,a.string=a.string.slice(0,i.ch-a.start)),(m=L.innerMode(t.getMode(),a.state)).mode.xmlCurrentTag){var o,l,g=[],f=!1,c=/\btag\b/.test(a.type)&&!/>$/.test(a.string),h=c&&/^\w/.test(a.string);if(h){var u=t.getLine(i.line).slice(Math.max(0,a.start-2),a.start),d=/<\/$/.test(u)?"close":/<$/.test(u)?"open":null;d&&(l=a.start-("close"==d?2:1))}else c&&"<"==a.string?d="open":c&&"</"==a.string&&(d="close");var p=m.mode.xmlCurrentTag(m.state);if(!c&&!p||d){h&&(o=a.string),f=d;var m,v=m.mode.xmlCurrentContext?m.mode.xmlCurrentContext(m.state):[],y=(m=v.length&&v[v.length-1])&&r[m],x=m?y&&y.children:r["!top"];if(x&&"close"!=d)for(var C=0;C<x.length;++C)o&&!H(x[C],o,s)||g.push("<"+x[C]);else if("close"!=d)for(var b in r)!r.hasOwnProperty(b)||"!top"==b||"!attrs"==b||o&&!H(b,o,s)||g.push("<"+b);m&&(!o||"close"==d&&H(m,o,s))&&g.push("</"+m+">")}else{var O=(y=p&&r[p.name])&&y.attrs,w=r["!attrs"];if(!O&&!w)return;if(O){if(w){var A={};for(var M in w)w.hasOwnProperty(M)&&(A[M]=w[M]);for(var M in O)O.hasOwnProperty(M)&&(A[M]=O[M]);O=A}}else O=w;if("string"==a.type||"="==a.string){var P,$=(u=t.getRange(k(i.line,Math.max(0,i.ch-60)),k(i.line,"string"==a.type?a.start:a.end))).match(/([^\s\u00a0=<>\"\']+)=$/);if(!$||!O.hasOwnProperty($[1])||!(P=O[$[1]]))return;if("function"==typeof P&&(P=P.call(this,t)),"string"==a.type){o=a.string;var I=0;/['"]/.test(a.string.charAt(0))&&(n=a.string.charAt(0),o=a.string.slice(1),I++);var T=a.string.length;if(/['"]/.test(a.string.charAt(T-1))&&(n=a.string.charAt(T-1),o=a.string.substr(I,T-2)),I){var j=t.getLine(i.line);j.length>a.end&&j.charAt(a.end)==n&&a.end++}f=!0}for(C=0;C<P.length;++C)o&&!H(P[C],o,s)||g.push(n+P[C]+n)}else for(var q in"attribute"==a.type&&(o=a.string,f=!0),O)!O.hasOwnProperty(q)||o&&!H(q,o,s)||g.push(q)}return{list:g,from:f?k(i.line,null==l?a.start:l):i,to:f?k(i.line,a.end):i}}}})});